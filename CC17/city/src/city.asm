;  *************************; * ÎÐÈÎÍ-128.2 "CITY" 256B *; *       VERSION 2.2       *; *   BY RIDDLE (C) 2016,7  *;  *************************ORG 0MVI A,1FHCALL 0F80FHJMP CLSSETCLR:		; RST 1 -> HL - ADDRESS, C - COLORMVI A,1JMP 0F839HRAND:DW 0F901HROOF:PCHLWINDOWS:	; RST 2 -> L - Y, BC - MASKMOV A,LRARRARRNCRST 7ANA BRZRARXRA BMOV B,ARST 7ANA CRALXRA CMOV C,ARETBUFFER:EQU 200HBUILD:		; RST 4 -> DE - CODE, B - MASK, C - ROOFPUSH DMOV L,CLXI D,BUFFERJMP BU0GROW:		; RST 5 -> D - X, E - SIZEMVI C,0GR2:LXI H,BUFFERJMP GR0CLR:		; RST 6 -> HL - SCREEN, B - EOS, C - COLORRST 1INX HMOV A,HCMP BJNZ CLRRETRND: 		; RST 7PUSH HLHLD RANDMOV A,LINR LADC MSHLD RANDPOP HRETCLS:MVI H,0C0HLXI B,0F008HRST 6MVI H,0CEHLXI B,0E293HRST 6START:MVI A,10BGBLD:PUSH PSWLXI B,7C00H+ROOF2LXI D,5555HRST 4XTHLMVI A,71HSUB HXTHLRLCMOV D,ARST 7ANI 1CHADI 58HMOV E,ARST 5POP PSWDCR AJNZ BGBLDLXI D,0D980HRST 5LXI B,0100H+ROOF2LXI D,0AD5AHRST 4LXI D,0DDB0HRST 5LXI B,8000H+ROOF1LXI D,0E5FCHRST 4LXI D,0D1C0HRST 5LOOP:CALL 0F82DH	; DELAY + DE=0MVI E,LOOPPUSH DRST 7ANI 0FHADI 0D1HMOV H,ARST 7ORI 83HMOV L,AANA MRPMVI A,1CALL 0F836H	; READ COLORMVI A,70HXRA CMOV C,ARST 1RETBU0:MOV C,BMOV B,EBU1:XRA AMOV H,AXTHLDAD HRALDAD HRALRLCXTHLPUSH PSWXCHGFLOOR:		; HL - DST, BC - MASK, A - COUNTPUSH BPUSH PSWRST 2MOV M,BINX HMOV M,CINX HPOP PSWPOP BDCR AJNZ FLOORXCHGCALL ROOFMOV A,BANI 7FHMOV B,APOP PSWORA AJNZ BU1POP BRETROOF2:MOV A,CCPI 7CNC ROOF1ROOF1:		; BC - MASKPUSH HMOV H,BMOV L,CDAD HMOV A,CRARORA CORA LMOV C,AMOV B,HPOP HRETGR0:MOV B,DDCR CPUSH BGR1:EIRST 7MOV A,MSTAX BINR BINX HMOV A,MSTAX BDCR BINX HINR CJNZ GR1DIPOP BDCR EJNZ GR2MOV A,DRRCRNCINR BINR BMVI C,91H	; FOREGROUND BUILDING COLORSXCHGRST 6RETEND